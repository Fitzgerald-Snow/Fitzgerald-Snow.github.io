# .github/workflows/sync-thoughts.yml
name: Sync Thoughts Data        # å·¥ä½œæµåå­—

on:                              # è§¦å‘æ¡ä»¶
  schedule:                      #   â‘  å®šæ—¶ï¼šæ¯ 6 å°æ—¶ä¸€æ¬¡
    - cron: '0 */6 * * *'
  workflow_dispatch:             #   â‘¡ äººæ‰‹ç‚¹æŒ‰é’®ä¹Ÿè¡Œ

permissions:                     # è®©æœºå™¨äººæœ‰æ¨ä»£ç çš„æƒåŠ›
  contents: write

jobs:
  sync:                          # åªæœ‰ä¸€ä¸ª jobï¼Œå« sync
    runs-on: ubuntu-latest       # åœ¨ GitHub çš„ Linux è™šæœºä¸Šè·‘

    steps:                       # ====== ä¸‹é¢æ˜¯ä¸€æ­¥æ­¥æŒ‡ä»¤ ======
      - uses: actions/checkout@v4          # â‘  æ‹‰å–ä½ çš„ä»£ç 
      - uses: actions/setup-node@v4        # â‘¡ å®‰è£… Node 18
        with:
          node-version: 18

      - name: Decode service account       # â‘¢ è§£ç ç§é’¥æ–‡ä»¶
        run: |
          echo "$FIREBASE_SERVICE_ACCOUNT" | base64 -d > firebase-service-account.json
        env:
          FIREBASE_SERVICE_ACCOUNT: ${{ secrets.FIREBASE_SERVICE_ACCOUNT }}

      - run: npm ci                        # â‘£ å®‰è£…ä¾èµ–
      - run: npm run sync-thoughts         # â‘¤ è¿è¡Œä½ çš„åŒæ­¥è„šæœ¬

      - name: Commit & push if changed     # â‘¥ å¦‚æœé™æ€æ–‡ä»¶æ›´æ–°å°±æäº¤
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name  "GitHub Action"
          if [[ `git status --porcelain` ]]; then
            git add thoughts-static.js
            git commit -m "ğŸ¤– è‡ªåŠ¨æ›´æ–°é™æ€æ€æƒ³æ•°æ®"
            git push
          else
            echo "No changes â€“ skip commit."
          fi
